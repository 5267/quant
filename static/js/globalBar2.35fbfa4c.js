define("achy/biz/globalBar2/tab",[],function(){"use strict";var t=function(t){this.element=$(t)};t.VERSION="3.3.4",t.TRANSITION_DURATION=150,t.prototype.show=function(){var t=this.element,e=t.closest("ul:not(.dropdown-menu)"),n=t.data("target");if(n||(n=t.attr("href"),n=n&&n.replace(/.*(?=#[^\s]*$)/,"")),!t.parent("li").hasClass("active")){var a=e.find(".active:last a"),i=$.Event("hide.bs.tab",{relatedTarget:t[0]}),o=$.Event("show.bs.tab",{relatedTarget:a[0]});if(a.trigger(i),t.trigger(o),!o.isDefaultPrevented()&&!i.isDefaultPrevented()){var s=$(n);this.activate(t.closest("li"),e),this.activate(s,s.parent(),function(){a.trigger({type:"hidden.bs.tab",relatedTarget:t[0]}),t.trigger({type:"shown.bs.tab",relatedTarget:a[0]})})}}},t.prototype.activate=function(e,n,a){function i(){o.removeClass("active").find("> .dropdown-menu > .active").removeClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!1),e.addClass("active").find('[data-toggle="tab"]').attr("aria-expanded",!0),s?(e[0].offsetWidth,e.addClass("in")):e.removeClass("fade"),e.parent(".dropdown-menu").length&&e.closest("li.dropdown").addClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!0),a&&a()}var o=n.find("> .active"),s=a&&$.support.transition&&(o.length&&o.hasClass("fade")||!!n.find("> .fade").length);o.length&&s?o.one("bsTransitionEnd",i).emulateTransitionEnd(t.TRANSITION_DURATION):i(),o.removeClass("in")};return t}),define("tpl!achy/biz/globalBar2/messageCenter.tpl",[],function(){return function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div class="dropdown click">\n    <div class="dropdown-toggle" data-toggle="dropdown">\n        <i class="fa fa-bell"></i>\n        <span class="count">3</span>\n    </div>\n    <div class="dropdown-menu">\n        <div class="message-list">\n            <div class="title">\n                通知中心\n                <span class="read-all">全部忽略</span>\n            </div>\n            <ul class="nav nav-pills">\n                <li class="active">\n                    <a href="#message-center-unread" data-toggle="tab" data-status="unread">未读</a>\n                </li>\n                <li>\n                    <a href="#message-center-read" data-toggle="tab" data-status="read">已读</a>\n                </li>\n            </ul>\n            <div class="tab-content">\n                <ul class="letters letters-unread tab-pane active" id="message-center-unread" data-status="unread">\n                    <li class="empty"><span class="spinner"></span></li>\n                </ul>\n                <ul class="letters letters-read tab-pane" id="message-center-read" data-status="read">\n                    <li class="empty"><span class="spinner"></span></li>\n                </ul>\n            </div>\n        </div>\n    </div>\n</div>\n';return __p}}),define("tpl!achy/biz/globalBar2/messageItem.tpl",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<li class="letter" data-id="'+(null==(__t=id)?"":__t)+'">\n    <a href="'+(null==(__t=url)?"":__t)+'" title="'+__e(subject)+'" target="_blank">\n        <h5>'+__e(subject)+'</h5>\n        <span class="date">'+__e(time)+'</span>\n        <span class="desc">'+__e(content)+'</span>\n    </a>\n    <span class="read"><i class="fa fa-times-circle"></i></span>\n</li>\n';return __p}}),define("tpl!achy/biz/globalBar2/notifyItem.tpl",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="notify-item">\n    <i class="fa fa-comment"></i>\n    <a href="'+(null==(__t=url)?"":__t)+'" target="_blank" class="summary">'+__e(subject)+'</a>\n    <span class="read">\n        <i class="fa fa-times-circle"></i>\n    </span>\n</div>\n';return __p}}),define("achy/biz/globalBar2/messageCenter",["lodash","./tab","tpl!./messageCenter.tpl","tpl!./messageItem.tpl","tpl!./notifyItem.tpl"],function(t,e,n,a,i){var o="webmail",s=function(t,e){t.velocity({opacity:1},{duration:0}).velocity({opacity:0,height:0,"padding-top":0,"padding-bottom":0,"margin-top":0,"margin-bottom":0},{duration:200,easing:"ease-in-out",complete:function(){e&&e(t)}})},r=function(t){var a=this;this.$el=$(t.el),this.$el.append(n()),this.unreadList=this.$el.find(".letters-unread"),this.readList=this.$el.find(".letters-read"),this.unreadBadge=this.$el.find(".dropdown-toggle .count"),this.status="unread",this.$el.find(".dropdown-menu").on("click",".nav a",function(t){t.preventDefault(),new e(t.currentTarget).show()}).on("click",".letters-unread .read",function(t){var e=$(t.currentTarget).parent();a.markRead(e),t.stopPropagation()}).on("click",".letters-read .read",function(t){var e=$(t.currentTarget).parent();a.deleteMessage(e)}).on("click",".letters-unread .letter",function(t){a.markRead($(t.currentTarget)),t.stopPropagation()}).on("click",".read-all:not(.disabled)",function(t){var e=$(t.currentTarget);e.addClass("disabled"),"unread"===a.status?a.markAllRead().always(function(){e.removeClass("disabled")}):a.deleteAll().always(function(){e.removeClass("disabled")})}),this.$el.find(".dropdown-menu").click(function(t){t.stopPropagation()}),this.listenScroll(this.unreadList),this.listenScroll(this.readList),this.initNotify(),this.$el.parent().on("shown.bs.dropdown",function(){var t=a.$el.find(".nav .active a");t.trigger("shown.bs.tab",{target:t})}),this.$el.find(".nav a").on("shown.bs.tab",function(t){var e=$(t.target).data("status");a.loadLetters({status:e},!0),a.status=e,a.$el.find(".read-all").text("unread"===e?"全部忽略":"全部清除")})},d=r.prototype;return d.loadLetters=function(e,n){var a=this,i="unread"===e.status?this.unreadList:this.readList;i.data("loading")||(e=t.defaults(e||{},{status:"unread",pageIndex:1,pageSize:10}),e.status=e.status.toUpperCase(),$.data(i[0],"loading",!0),$.ajax({url:window.getapi(o,"/letterList"),type:"GET",data:e,xhrFields:{withCredentials:!0},headers:{"content-type":"application/json"}}).done(function(t){var o;0===t.code&&($.data(i[0],"page",t.content.pageIndex),$.data(i[0],"loading",!1),"UNREAD"===e.status&&a.updateUnreadBadge(t.content.totalcount),a.renderLetters(i,t.content.data,n),o=t.content.totalcount/t.content.pageSize,(t.content.pageIndex===Math.floor(o)+1||t.content.pageIndex===o)&&$.data(i[0],"nomore",!0))}))},d.renderLetters=function(e,n,i){var o=(new Date).toISOString().split("T")[0],s=new Date(Date.now()-864e5).toISOString().split("T")[0],r=null;i&&(e.empty().scrollTop(0),$.data(e[0],"nomore",!1)),t.isEmpty(n)?this.listEmpty(e):(e.find(".empty").remove(),r=e.find(".header").last().data("date")),t.each(n,function(t){var n=t.receiveTimestamp-60*(new Date).getTimezoneOffset()*1e3,i=new Date(n).toISOString().split("T")[0],d=$('<li class="header"></li>');i!==r&&(i===o?(d.text("今天"),r=o):i===s?(d.text("昨天"),r=s):(d.text(i),r=i),$.data(d[0],"date",i),e.append(d)),t.time=new Date(n).toISOString().replace(/.*?T(\d\d\:\d\d).*?Z/,function(t,e){return e}),e.append(a(t))})},d.itemRemoved=function(t,e){var n=this;t.prev().is(".header")&&t.next().is(".header")&&s(t.prev(".header"),function(t){t.remove()}),s(t,function(t){t.remove(),0===e.find(".letter").length&&n.listEmpty(e)})},d.allItemRemoved=function(t){var e=this;1===t.children().length&&t.children().is(".empty")||s(t.find("li"),function(n){n.remove(),e.listEmpty(t)})},d.markRead=function(t){var e=this;$.ajax({xhrFields:{withCredentials:!0},url:window.getapi(o,"/letter/mailId")+"?mailId="+t.data("id"),type:"PUT"}).done(function(n){0===n.code&&n.content&&(e.itemRemoved(t,e.unreadList),e.updateUnreadBadge(-1))})},d.markAllRead=function(){var t=this;return $.ajax({url:window.getapi(o,"/letter"),type:"PUT",xhrFields:{withCredentials:!0}}).done(function(e){0===e.code&&e.content&&(t.allItemRemoved(t.unreadList),t.updateUnreadBadge(0))})},d.deleteMessage=function(t){var e=this;$.ajax({url:window.getapi(o,"/letter/mailId")+"?mailId="+t.data("id"),type:"DELETE",xhrFields:{withCredentials:!0}}).done(function(n){0===n.code&&n.content&&e.itemRemoved(t,e.readList)})},d.deleteAll=function(){var t=this;return $.ajax({url:window.getapi(o,"/letter"),type:"DELETE",xhrFields:{withCredentials:!0}}).done(function(e){0===e.code&&e.content&&t.allItemRemoved(t.readList)})},d.listEmpty=function(t){t.empty().append('<li class="empty">没有消息</li>')},d.listenScroll=function(t){var e,n=this;t.on("scroll",function(){if(t.scrollTop()+t.height()+20>t.prop("scrollHeight")){if(t.data("nomore"))return;e=t.data("page")+1,n.loadLetters({status:t.data("status"),pageIndex:e})}})},d.updateUnreadBadge=function(t){-1===t&&(t=parseInt(this.unreadBadge.text()||0)-1),0===t?this.unreadBadge.hide():this.unreadBadge.show().text(t)},d.initNotify=function(){var t=this;this.notifies=$('<div class="message-center-notifies"></div>'),$(document.body).append(this.notifies),this.notifies.on("click",".read",function(e){var n=$(e.currentTarget);t.notifyRemove(n.parent(),!0)}),this.notifyPollInit()},d.notifyRemove=function(t,e){var n={opacity:0};e&&(n={opacity:0,height:0,"margin-bottom":0,"padding-top":0,"padding-bottom":0}),t.velocity("stop").velocity(n,{duration:250,easing:"ease-out"}),setTimeout(function(){t.remove()},250)},d.notifyReceived=function(t){var e,n=this,a=$(i(t));this.notifies.prepend(a),a.velocity({height:0,opacity:0,translateX:"270px","margin-bottom":0,"padding-top":0,"padding-bottom":0},{duration:0}).velocity({height:"56px","margin-bottom":"15px","padding-top":"10px","padding-bottom":"10px"},{duration:250,easing:"ease-in-out"}),setTimeout(function(){a.velocity({translateX:0,opacity:1},{duration:150,easing:"ease-in-out"})},100),setTimeout(function(){n.notifyRemove(a)},6e3),n.notifies.find(".notify-item").length>3&&(e=n.notifies.find(".notify-item").eq(3),n.notifyRemove(e))},d.notifyPollInit=function(){var e=this,n=function(){$.ajax({url:window.getapi(o,"/popLetter"),type:"GET",data:{recordId:e.recordID||0},xhrFields:{withCredentials:!0}}).done(function(n){var a;if(0===n.code&&n.content){if(e.recordID=n.content.recordId,e.updateUnreadBadge(n.content.totalUnread),!n.content.newList)return;a=t.first(n.content.newList,3),t.each(a,function(t,n){setTimeout(function(){e.notifyReceived(t)},500*n)})}}).always(function(){setTimeout(n,6e4)})};setTimeout(function(){n()},5e3)},r}),define("achy/biz/globalBar2/modal",["lodash"],function(t){"use strict";!function(){function t(){var t=document.createElement("bootstrap"),e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var n in e)if(void 0!==t.style[n])return{end:e[n]};return!1}$.fn.emulateTransitionEnd=function(t){var e=!1,n=this;$(this).one("bsTransitionEnd",function(){e=!0});var a=function(){e||$(n).trigger($.support.transition.end)};return setTimeout(a,t),this},$(function(){$.support.transition=t(),$.support.transition&&($.event.special.bsTransitionEnd={bindType:$.support.transition.end,delegateType:$.support.transition.end,handle:function(t){return $(t.target).is(this)?t.handleObj.handler.apply(this,arguments):void 0}})})}();var e=function(t,e){this.options=e,this.$body=$(document.body),this.$element=$(t),this.$dialog=this.$element.find(".modal-dialog"),this.$backdrop=null,this.isShown=null,this.originalBodyPad=null,this.scrollbarWidth=0,this.ignoreBackdropClick=!1,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,$.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};e.VERSION="3.3.4",e.TRANSITION_DURATION=300,e.BACKDROP_TRANSITION_DURATION=150,e.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},e.prototype.toggle=function(t){return this.isShown?this.hide():this.show(t)},e.prototype.show=function(t){var n=this,a=$.Event("show.bs.modal",{relatedTarget:t});this.$element.trigger(a),this.isShown||a.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.setScrollbar(),this.$body.addClass("modal-open"),this.escape(),this.resize(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',$.proxy(this.hide,this)),this.$dialog.on("mousedown.dismiss.bs.modal",function(){n.$element.one("mouseup.dismiss.bs.modal",function(t){$(t.target).is(n.$element)&&(n.ignoreBackdropClick=!0)})}),this.backdrop(function(){var a=$.support.transition&&n.$element.hasClass("fade");n.$element.parent().length||n.$element.appendTo(n.$body),n.$element.show().scrollTop(0),n.adjustDialog(),a&&n.$element[0].offsetWidth,n.$element.addClass("in"),n.enforceFocus();var i=$.Event("shown.bs.modal",{relatedTarget:t});a?n.$dialog.one("bsTransitionEnd",function(){n.$element.trigger("focus").trigger(i)}).emulateTransitionEnd(e.TRANSITION_DURATION):n.$element.trigger("focus").trigger(i)}))},e.prototype.hide=function(t){t&&t.preventDefault(),t=$.Event("hide.bs.modal"),this.$element.trigger(t),this.isShown&&!t.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.resize(),$(document).off("focusin.bs.modal"),this.$element.removeClass("in").off("click.dismiss.bs.modal").off("mouseup.dismiss.bs.modal"),this.$dialog.off("mousedown.dismiss.bs.modal"),$.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",$.proxy(this.hideModal,this)).emulateTransitionEnd(e.TRANSITION_DURATION):this.hideModal())},e.prototype.enforceFocus=function(){$(document).off("focusin.bs.modal").on("focusin.bs.modal",$.proxy(function(t){this.$element[0]===t.target||this.$element.has(t.target).length||this.$element.trigger("focus")},this))},e.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keydown.dismiss.bs.modal",$.proxy(function(t){27==t.which&&this.hide()},this)):this.isShown||this.$element.off("keydown.dismiss.bs.modal")},e.prototype.resize=function(){this.isShown?$(window).on("resize.bs.modal",$.proxy(this.handleUpdate,this)):$(window).off("resize.bs.modal")},e.prototype.hideModal=function(){var t=this;this.$element.hide(),this.backdrop(function(){t.$body.removeClass("modal-open"),t.resetAdjustments(),t.resetScrollbar(),t.$element.trigger("hidden.bs.modal")})},e.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},e.prototype.backdrop=function(t){var n=this,a=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var i=$.support.transition&&a;if(this.$backdrop=$(document.createElement("div")).addClass("modal-backdrop "+a).appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",$.proxy(function(t){return this.ignoreBackdropClick?void(this.ignoreBackdropClick=!1):void(t.target===t.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus():this.hide()))},this)),i&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!t)return;i?this.$backdrop.one("bsTransitionEnd",t).emulateTransitionEnd(e.BACKDROP_TRANSITION_DURATION):t()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var o=function(){n.removeBackdrop(),t&&t()};$.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",o).emulateTransitionEnd(e.BACKDROP_TRANSITION_DURATION):o()}else t&&t()},e.prototype.handleUpdate=function(){this.adjustDialog()},e.prototype.adjustDialog=function(){var t=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&t?this.scrollbarWidth:"",paddingRight:this.bodyIsOverflowing&&!t?this.scrollbarWidth:""})},e.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:"",paddingRight:""})},e.prototype.checkScrollbar=function(){var t=window.innerWidth;if(!t){var e=document.documentElement.getBoundingClientRect();t=e.right-Math.abs(e.left)}this.bodyIsOverflowing=document.body.clientWidth<t,this.scrollbarWidth=this.measureScrollbar()},e.prototype.setScrollbar=function(){var t=parseInt(this.$body.css("padding-right")||0,10);this.originalBodyPad=document.body.style.paddingRight||"",this.bodyIsOverflowing&&this.$body.css("padding-right",t+this.scrollbarWidth)},e.prototype.resetScrollbar=function(){this.$body.css("padding-right",this.originalBodyPad)},e.prototype.measureScrollbar=function(){var t=document.createElement("div");t.className="modal-scrollbar-measure",this.$body.append(t);var e=t.offsetWidth-t.clientWidth;return this.$body[0].removeChild(t),e};var n,a;return a={title:"",content:""},n=function(n){var i,o,s,r;s=this,n=t.extend({},a,e.DEFAULTS,n),o='<div class="modal fade"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">关闭</span></button><h4 class="modal-title"></h4></div><div class="modal-body"></div><div class="modal-footer"></div></div></div></div>',i=$(o),this.body=i.find(".modal-body"),this.title=i.find(".modal-title"),this.footer=i.find(".modal-footer"),n.content&&(r=t.isFunction(n.content)?n.content():n.content,this.body.append(r)),n.title&&this.title.html(n.title),$(document.body).append(i),this.$el=i,this.m=new e(this.$el,n),this.show()},n.prototype.show=function(){this.m.show()},n.prototype.hide=function(){this.m.hide()},n.prototype.destroy=function(){this.hide(),this.$el.remove()},n}),define("achy/biz/globalBar2/button",[],function(){"use strict";function t(t){return this.each(function(){var n=$(this),a=n.data("bs.button"),i="object"==typeof t&&t;a||n.data("bs.button",a=new e(this,i)),"toggle"==t?a.toggle():t&&a.setState(t)})}var e=function(t,n){this.$element=$(t),this.options=$.extend({},e.DEFAULTS,n),this.isLoading=!1};e.VERSION="3.3.4",e.DEFAULTS={loadingText:"loading..."},e.prototype.setState=function(t){var e="disabled",n=this.$element,a=n.is("input")?"val":"html",i=n.data();t+="Text",null==i.resetText&&n.data("resetText",n[a]()),setTimeout($.proxy(function(){n[a](null==i[t]?this.options[t]:i[t]),"loadingText"==t?(this.isLoading=!0,n.addClass(e).attr(e,e)):this.isLoading&&(this.isLoading=!1,n.removeClass(e).removeAttr(e))},this),0)},e.prototype.toggle=function(){var t=!0,e=this.$element.closest('[data-toggle="buttons"]');if(e.length){var n=this.$element.find("input");"radio"==n.prop("type")&&(n.prop("checked")&&this.$element.hasClass("active")?t=!1:e.find(".active").removeClass("active")),t&&n.prop("checked",!this.$element.hasClass("active")).trigger("change")}else this.$element.attr("aria-pressed",!this.$element.hasClass("active"));t&&this.$element.toggleClass("active")};var n=$.fn.button;return $.fn.button=t,$.fn.button.Constructor=e,$.fn.button.noConflict=function(){return $.fn.button=n,this},function(e){e.on("click.bs.button.data-api",'[data-toggle^="button"]',function(e){var n=$(e.target);n.hasClass("btn")||(n=n.closest(".btn")),t.call(n,"toggle"),e.preventDefault()}).on("focus.bs.button.data-api blur.bs.button.data-api",'[data-toggle^="button"]',function(t){$(t.target).closest(".btn").toggleClass("focus",/^focus(in)?$/.test(t.type))})}}),define("tpl!achy/biz/globalBar2/feedbackForm.tpl",[],function(){return function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<form class="form">\n    <div class="form-group">\n        <textarea class="form-control feedback-content" placeholder="在这里写下您对产品的建议或疑惑"></textarea>\n    </div>\n</form>\n<div class="more-info">\n    更多问题请联系 <span class="text-primary">4000 820 386</span>\n    或<a href="mailto:info@datayes.com"> info@datayes.com</a>\n</div>\n';return __p}}),define("achy/biz/globalBar2/feedback",["./modal","./button","tpl!./feedbackForm.tpl"],function(t,e,n){var a,i;return a=function(n){var a=this;this.m=new t({title:"问题反馈"}),this.options=n,this.$el=this.m.$el,e(this.$el),this.$el.addClass("feedback-modal"),this.render(),this.$el.on("click",".submit",function(){a.submit()}).on("keyup",".feedback-content",function(){var t=a.$el.find(".feedback-content");t.val()&&t.parent().removeClass("has-error")}),this.$el.on("hidden.bs.modal",function(){a.m.destroy()})},i=a.prototype,i.render=function(){var t=n(),e=$('<button class="btn btn-primary submit" data-loading-text="请稍候...">提交</button>');this.m.body.append(t),this.m.footer.append(e),this.m.footer.prepend('<div class="error-msg"></div>')},i.submit=function(){var t,e,n,a,i,o=this,s=this.$el.find(".feedback-content"),r=this.$el.find(".submit"),d=o.$el.find(".error-msg");return t=o.options.app+"用户反馈",e=o.options.version||"",n=window.navigator.platform,a=window.navigator.userAgent,i=window.location.href,s?(r.button("loading"),d.text(""),s.val()?void $.ajax({url:window.getapi("cloud","/Feedback.json"),type:"POST",data:{"feedbackInfo.subject":t,"feedbackInfo.description":e,"feedbackInfo.comment_content":s.val(),"feedbackInfo.user_os":n,"feedbackInfo.user_ua":a,"feedbackInfo.user_pm":"","feedbackInfo.source":i},xhrFields:{withCredentials:!0}}).done(function(){o.m.hide()}).fail(function(){d.text("提交出错, 请稍后重试.")}).always(function(){r.button("reset")}):(r.button("reset"),void s.parent().addClass("has-error"))):void 0},a}),define("achy/biz/globalBar2/dropdown",[],function(){"use strict";function t(t){t&&3===t.which||($(n).remove(),$(a).each(function(){var n=$(this),a=e(n),i={relatedTarget:this};a.hasClass("open")&&(t&&"click"==t.type&&/input|textarea/i.test(t.target.tagName)&&$.contains(a[0],t.target)||(a.trigger(t=$.Event("hide.bs.dropdown",i)),t.isDefaultPrevented()||(n.attr("aria-expanded","false"),a.removeClass("open").trigger("hidden.bs.dropdown",i))))}))}function e(t){var e=t.attr("data-target");e||(e=t.attr("href"),e=e&&/#[A-Za-z]/.test(e)&&e.replace(/.*(?=#[^\s]*$)/,""));var n=e&&$(e);return n&&n.length?n:t.parent()}var n=".dropdown-backdrop",a='[data-toggle="dropdown"]',i=function(t){$(t).on("click.bs.dropdown",this.toggle)};return i.VERSION="3.3.4",i.prototype.toggle=function(n){var a=$(this);if(!a.is(".disabled, :disabled")){var i=e(a),o=i.hasClass("open");if(t(),!o){"ontouchstart"in document.documentElement&&!i.closest(".navbar-nav").length&&$(document.createElement("div")).addClass("dropdown-backdrop").insertAfter($(this)).on("click",t);var s={relatedTarget:this};if(i.trigger(n=$.Event("show.bs.dropdown",s)),n.isDefaultPrevented())return;a.trigger("focus").attr("aria-expanded","true"),i.toggleClass("open").trigger("shown.bs.dropdown",s)}return!1}},i.prototype.keydown=function(t){if(/(38|40|27|32)/.test(t.which)&&!/input|textarea/i.test(t.target.tagName)){var n=$(this);if(t.preventDefault(),t.stopPropagation(),!n.is(".disabled, :disabled")){var i=e(n),o=i.hasClass("open");if(!o&&27!=t.which||o&&27==t.which)return 27==t.which&&i.find(a).trigger("focus"),n.trigger("click");var s=" li:not(.disabled):visible a",r=i.find('[role="menu"]'+s+', [role="listbox"]'+s);if(r.length){var d=r.index(t.target);38==t.which&&d>0&&d--,40==t.which&&d<r.length-1&&d++,~d||(d=0),r.eq(d).trigger("focus")}}}},function(e){$(document).on("click.bs.dropdown.data-api",t),e.on("click.bs.dropdown.data-api",".dropdown form",function(t){t.stopPropagation()}).on("click.bs.dropdown.data-api",a,i.prototype.toggle).on("keydown.bs.dropdown.data-api",a,i.prototype.keydown).on("keydown.bs.dropdown.data-api",".dropdown-menu",i.prototype.keydown)}}),define("tpl!achy/biz/globalBar2/globalBar.html",[],function(){return function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<div class="global-bar2 clearfix">\n    ',fullWidth||(__p+='\n    <div class="container">\n    '),__p+='\n    <div class="logo">\n        <a href="'+(null==(__t=logoHref)?"":__t)+'"><img src="'+(null==(__t=logo)?"":__t)+'"></a>\n    </div>\n    <div class="global-nav"></div>\n    <div class="pull-right">\n        ',search&&(__p+='\n        <div class="search">\n            <span class="glyphicon glyphicon-search"></span>\n            <input class="search-keyword" type="text" placeholder="输入关键字">\n        </div>\n        '),__p+='\n        <a class="btn-login btn" href="javascript:void(0);">登录</a>\n        <a class="btn-register btn" href="javascript:void(0);">注册</a>\n        ',showUser&&(__p+='\n        <a href="#" class="feedback nlogin">反馈</a>\n        <div class="message-center nlogin"></div>\n        <div class="dropdown apps nlogin">\n            <div class="dropdown-toggle" data-toggle="dropdown">\n                <span class="glyphicon glyphicon-th"></span>\n            </div>\n            <div class="dropdown-menu">\n                <ul class="appDock" role="menu">\n                </ul>\n                <div class="more-app">\n                    <div class="links">\n                        <a class="app-dashboard" href="'+(null==(__t=appRoot)?"":__t)+'dashboard/"><span class="account-icon"></span>进入投资起点</a>\n                        <a class="app-cloud-portal" href="'+(null==(__t=appRoot)?"":__t)+'cloud-portal/"><span class="rocket-icon"></span>进入应用中心</a>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class="profile nlogin"></div>\n        '),__p+="\n    </div>\n    ",fullWidth||(__p+="\n    </div>\n    "),__p+="\n</div>\n";return __p}}),define("tpl!achy/biz/globalBar2/profile.html",[],function(){return function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div class="detail">\n    <span class="owner"></span>\n    <span class="username"></span>\n</div>\n<div class="dropdown">\n    <div class="dropdown-toggle" data-toggle="dropdown">\n        <img class="avatar">\n    </div>\n    <ul class="dropdown-menu" role="menu"></ul>\n</div>\n';return __p}}),define("tpl!achy/biz/globalBar2/appItem.html",[],function(){return function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<li>\n    <a href="'+(null==(__t=url)?"":__t)+'" title="'+(null==(__t=name)?"":__t)+'" target="_blank">\n        <img class="appIcon" src="'+(null==(__t=appLogoUrl)?"":__t)+'">\n        <span class="appName">'+(null==(__t=name)?"":__t)+"</span>\n    </a>\n</li>\n";return __p}}),define("tpl!achy/biz/globalBar2/profileItem.html",[],function(){return function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<li>\n    <a href="'+(null==(__t=url)?"":__t)+'">\n        <span>'+(null==(__t=name)?"":__t)+"</span>\n    </a>\n</li>\n";return __p}}),define("tpl!achy/biz/globalBar2/navigationItem.html",[],function(){return function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<li data-name="'+(null==(__t=name)?"":__t)+'">\n    <a href="'+(null==(__t=url)?"":__t)+'">'+(null==(__t=title)?"":__t)+"</a>\n</li>\n";return __p}}),define("achy/biz/globalBar2/main",["lodash","./messageCenter","./feedback","./dropdown","tpl!achy/biz/globalBar2/globalBar.html","tpl!achy/biz/globalBar2/profile.html","tpl!achy/biz/globalBar2/appItem.html","tpl!achy/biz/globalBar2/profileItem.html","tpl!achy/biz/globalBar2/navigationItem.html","css!fontawesome","css!achy/biz/globalBar2/style.css"],function(t,e,n,a,i,o,s,r,d){"use strict";var l={fullWidth:!1,search:!1,user:{name:"",avatar:""},showUser:!0,appRoot:"/",owner:"",logo:null,logoWidth:0,logoHref:"./",logoutWithRedirect:!0,messageCenter:!0,feedback:{app:"",version:""},navs:[],profileMenu:[],personalRegister:!1,error:function(){}},c=null,p=window.getapi("cloud","/identity.json"),u=window.getapi("cloud","/user/service.json"),h=window.getapi("usermaster","/logout.json"),f=window.getapi("cloud","/userCenter/getPic.json?imageId="),m=function(e){var n=this,o=$(document.body);n.opts=t.defaults(e||{},l),n.profileMenuItemTpl=t.template('<li class="<%= className %>"><a href="<%= url %>"><%= name %></a></li>'),n.$el=$(i(n.opts)),o.append(n.$el),a(n.$el),n.opts.logoWidth&&n.$el.find(".apps .dropdown-toggle img").width(n.opts.logoWidth),o.on("logined",function(t,e){n.loginedCallback(e)}).on("anonymous",function(){n.$el.find(".nlogin").hide(),n.$el.find(".pull-right .btn").css("display","inline-block"),n.$el.find(".profile").empty(),n.$el.find(".message-center").empty()}),this.nav=new g({el:this.$el.find(".global-nav"),navs:this.opts.navs}),this.nav.render(),n.validLogin(function(t){n.loginedCallback(t)},function(){n.opts&&n.opts.error&&n.opts.error()});var s=document.createElement("a");this.$el.on("click",".btn-login",function(e){s.href=t.template(n.opts.appRoot+"login.html?RelayState=<%= encodeURIComponent(location.href) %>")(),window.location.href=s.href,e.preventDefault()}).on("click",".btn-register",function(e){s.href=t.template(n.opts.appRoot+"cloud-portal/#/application/start?RelayState=<%= encodeURIComponent(location.href) %>&registType=<%= registType %>")({registType:n.opts.personalRegister?"personal":""}),window.location.href=s.href,e.preventDefault()})};m.prototype.loginedCallback=function(t){this.$el.find(".nlogin").css("display","inline-block"),this.$el.find(".pull-right .btn").hide(),this.renderProfile(t),-1===t.user.principalName.search("@wmcloud.com")?this.$el.find(".app-dashboard").show():this.$el.find(".app-dashboard").hide(),this.opts.user&&this.addDefaultMenuItem(t),this.renderApps(),this.opts.messageCenter&&this.renderMessageCenter(),this.opts.feedback&&this.renderFeedback()},m.prototype.renderProfile=function(t){var e=this,n=function(t){var n=t.user.name;t.user.surname&&t.user.givenName?n=t.user.surname+t.user.givenName:t.user.nickName&&(n=t.user.nickName),e.$el.find(".owner").text(t.tenant.company).end().find(".username").text(n)};this.$el.find(".profile").html(o()),t?(this.renderAvatar(t),n(t)):$.ajax({url:p,type:"get",success:function(t){e.renderAvatar(t),n(t)},xhrFields:{withCredentials:!0},error:function(){}})},m.prototype.renderAvatar=function(e){var n=this.$el.find(".avatar");e.user.imageId?t.isNaN(parseInt(e.user.imageId))?e.user.imageId&&n.removeClass("default-avatar").attr({src:window.getfile(e.user.imageId)}):$.ajax({url:f+e.user.imageId,type:"GET",xhrFields:{withCredentials:!0},dataType:"json"}).done(function(t){0===t.code&&n.removeClass("default-avatar").attr({src:"data:image/jpeg;base64,"+t.data})}):n.addClass("default-avatar").attr({src:this.opts.appRoot+"cloud-portal/img/account/avatar-bg.png"})},m.prototype.addProfileMenuItem=function(e){var n=this;n.profileMenu=n.$el.find(".profile .dropdown-menu"),e=t.defaults(e,{className:"",url:"javascript:void(0)"});var a=$(r(e));return n.profileMenu.append(a),e.events&&t.each(e.events,function(e,n){a.on(n,t.bind(e,a))}),a},m.prototype.addDefaultMenuItem=function(e){var n=this;t.each(this.opts.profileMenu,function(t){n.addProfileMenuItem(t)}),this.addProfileMenuItem({name:"设置",url:this.opts.appRoot+"cloud-portal/#/myaccount/personalInfo"}),e.user.admin&&this.addProfileMenuItem({name:"进入后台管理",url:this.opts.appRoot+"cloud-management/#/management"}),e.user.superAdmin&&(this.addProfileMenuItem({name:"进入租户管理",url:this.opts.appRoot+"cloud-super/#/super"}),this.addProfileMenuItem({name:"进入邀请管理",url:this.opts.appRoot+"cloud-super/#/admin"})),this.addProfileMenuItem({name:"退出",url:"#",events:{click:function(t){$.ajax({url:h,type:"GET",xhrFields:{withCredentials:!0}}).done(function(){return n.opts.logoutWithRedirect?void(window.location.href=n.opts.appRoot+"login.html?RelayState="+encodeURIComponent(window.location.href)):void $(document.body).trigger("anonymous")}),t.preventDefault()}}})},m.prototype.validLogin=function(t,e){$.ajax({url:p,type:"GET",xhrFields:{withCredentials:!0},success:function(n){n&&!n.anonymous?t&&t(n):e&&e(n)},error:function(){}})},m.prototype.renderApps=function(){var e=this.$el.find(".apps .appDock"),n=function(n){e.empty(),t.each(n,function(t){t.enabled&&e.append(s(t))})};c?n(c):$.ajax({url:u,type:"get",xhrFields:{withCredentials:!0},success:function(e){e&&t.isArray(e)&&(c=e,c.sort(function(t,e){return t.orderNum-e.orderNum}),n(c))},error:function(){}})},m.prototype.renderMessageCenter=function(){var t=this.$el.find(".message-center");t.empty(),this.mc=new e({el:t[0]})},m.prototype.renderFeedback=function(){var t=this;this.$el.off("click.feedback"),this.$el.on("click.feedback",".feedback",function(e){t.feedback=new n(t.opts.feedback),e.preventDefault()})};var g=function(t){this.$el=$(t.el),this.navs=t?t.navs:[]};return g.prototype.render=function(){var e=this;t.each(this.navs,function(t){e.addItem(t)})},g.prototype.addItem=function(e){t.defaults(e,{url:"javascript:void(0)"}),this.$el.append(d(e))},g.prototype.activate=function(e){t.isString(e)&&this.$el.find("li").removeClass("active").end().find('li[data-name="'+e+'"]').addClass("active")
},m}),define("achy/biz/globalBar2",["achy/biz/globalBar2/main"],function(t){return t});